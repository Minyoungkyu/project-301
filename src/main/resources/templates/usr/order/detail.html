<html layout:decorate="~{usr/common/layout}">

<head>
    <title th:text="|결제 상세|"></title>
</head>

<body>

<div class="flex-1 flex items-center justify-center" layout:fragment="content">
    <script src="https://js.tosspayments.com/v1"></script>
    <div class="container w-full px-4">
        <h1 class="mb-4">
            <i class="fa-solid fa-pen"></i>
            <span th:text="|결제|"></span>
        </h1>

        <script th:inline="javascript">
            const orderId = /*[[ ${order.id} ]]*/ null;
            const buyerName = /*[[ ${order.buyer.nickname} ]]*/ null;
            const orderName = /*[[ ${order.name} ]]*/ null;
            const orderPayPrice = /*[[ ${order.calculatePayPrice} ]]*/ null;
        </script>

        <section class="section section-write container mx-auto">

            <div class="px-2 pt-4">
                <h1 class="font-bold text-lg">주문 상세내용</h1>

                <div class="flex flex-col gap-3 mt-3">

                    <div>
                        주문번호 : [[${order.id}]]
                    </div>

                    <div>
                        주문날짜 : [[${order.createDate}]]
                    </div>

                    <div>
                        주문자 : [[${order.buyer.nickname}]]
                    </div>

                    <div>
                        주문가격 : [[${order.calculatePayPrice}]]
                    </div>

                    <div>
                        <div th:each="orderItem : ${order.orderItems}">
                            <div>
                                강의명 : [[${orderItem.product.lecture.subject}]] /
                                강사명 : [[${orderItem.product.producer.producerName}]] /
                                가격 : [[${orderItem.salePrice}]]
                            </div>
                        </div>
                    </div>

                    <div th:if="${order.payable}">
                        <button th:if="${order.payable}" onclick="payment();" class="btn btn-sm btn-primary">카드결제</button>
                        <span th:if="${order.isPaid}">결제완료</span>
                        <div>
                            <span>PG결제가격 : </span>
                            <span id="PaymentForm__pgPayPriceDisplay">
                        </span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <script>
            const $PaymentForm__pgPayPriceDisplay = $("#PaymentForm__pgPayPriceDisplay");

            const pgPayPrice = orderPayPrice;

            $PaymentForm__pgPayPriceDisplay.text(pgPayPrice);

            const tossPayments = TossPayments("클라이언트 키");

            function payment() {
                const method = "카드"; // "카드" 혹은 "가상계좌"

                const paymentData = {
                    amount: orderPayPrice,
                    orderId: "order__" + orderId + "__" + (Math.random() + "").substring(2),
                    orderName,
                    customerName: buyerName,
                    successUrl: window.location.origin + "/usr/order/" + orderId + "/success",
                    failUrl: window.location.origin + "/usr/order/" + orderId + "/fail"
                };

                tossPayments.requestPayment(method, paymentData);
            }
        </script>

    </div>
</div>


</body>

</html>